using System;
using System.Configuration;
using System.Web.Mvc;
using hlcWeb.ViewModels;

namespace hlcWeb.Controllers
{
    public class LogonController : Controller
    {
        private readonly Api.UsersController _userRepository;
        public LogonController()
        {
            _userRepository = new Api.UsersController();
        }

        public ActionResult Logon(string returnUrl, string infoMsg)
        {     
            //var msg = Environment.GetEnvironmentVariable("HLC_CONNECTION");
#if DEBUG
            var user = _userRepository.Logon("jeff.holman@yahoo.com", "jholman");
                Session["User"] = user;
                Session["UserId"] = user.UserId;
                Session["UserRole"] = user.UserRole;
            return RedirectToAction("Search", "Home");
#else
                ViewBag.ReturnUrl = returnUrl;
                var viewModel = new LogonViewModel
                {
                    Email = "",
                    Password = "",
                    InfoMessage = ""
                };

                return View(viewModel);
#endif
        }

        [HttpPost]
        [AllowAnonymous]
        public ActionResult Logon(LogonViewModel viewModel, string returnUrl)
        {
            if (!ModelState.IsValid)
            {
                return View(viewModel);
            }

            var user = _userRepository.Logon(viewModel.Email, viewModel.Password);

            if (user == null)
            {
                viewModel.ErrorMessage = "Invalid email address or password was entered.";
                return View(viewModel);
            }
            else
            {
                Session["User"] = user;
                Session["UserId"] = user.UserId;
                Session["UserRole"] = user.UserRole;
                return RedirectToAction("Search", "Home");
            }

            
        }

        [HttpPost]
        [AllowAnonymous]
        public string LookupWord(string wordId)
        {
            return "{\r\n    \"metadata\": {\r\n        \"provider\": \"Oxford University Press\"\r\n    },\r\n    \"results\": [\r\n        {\r\n            \"id\": \"back\",\r\n            \"language\": \"en\",\r\n            \"lexicalEntries\": [\r\n                {\r\n                    \"entries\": [\r\n                        {\r\n                            \"homographNumber\": \"000\",\r\n                            \"senses\": [\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"the derrier surface of the human body from the shoulders to the hips\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.006\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the upper surface of an animal's body that corresponds to a person's back\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.009\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the spine of a person or animal.\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.010\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the main structure of a ship's hull or an aircraft's fuselage\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.011\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the part of a chair against which the sitter's back rests.\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.012\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the part of a garment that covers a person's back\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.013\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"a person's back regarded as carrying a load or bearing an imposition\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.015\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"the side or part of something that is away from the spectator or from the direction in which it moves or faces; the rear\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.017\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the position directly behind someone or something\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.018\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"the side or part of an object that is not normally seen or used\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.019\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"a player in a team game who plays in a defensive position behind the forwards\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.022\"\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"the grounds of Cambridge colleges which back on to the River Cam.\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.025\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    \"language\": \"en\",\r\n                    \"lexicalCategory\": \"Noun\",\r\n                    \"text\": \"back\"\r\n                },\r\n                {\r\n                    \"entries\": [\r\n                        {\r\n                            \"homographNumber\": \"001\",\r\n                            \"senses\": [\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"in the opposite direction from the one that one is facing or travelling towards\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.030\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"expressing movement of the body into a reclining position\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.032\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"at a distance away\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.033\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"behind\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.034\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"losing by a specified margin\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.035\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"so as to return to an earlier or normal position or condition\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.037\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"at a place previously left or mentioned\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.038\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"fashionable again\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.039\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"in or into the past\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.041\"\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"in return\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.043\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    \"language\": \"en\",\r\n                    \"lexicalCategory\": \"Adverb\",\r\n                    \"text\": \"back\"\r\n                },\r\n                {\r\n                    \"entries\": [\r\n                        {\r\n                            \"homographNumber\": \"002\",\r\n                            \"senses\": [\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"give financial, material, or moral support to\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.046\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"supplement in order to strengthen\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.052\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"be in favour of\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.053\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"(in popular music) provide musical accompaniment to (a singer or musician)\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.054\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"bet money on (a person or animal) winning a race or contest\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.055\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"cover the back of (an article) in order to support, protect, or decorate it\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.057\"\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"walk or drive backwards\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.059\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"(of the wind) change direction anticlockwise around the points of the compass\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.060\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"put (a sail) aback in order to slow the vessel down or assist in turning through the wind.\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.061\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"(of a building or other structure) have its back facing or adjacent to\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.063\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"lie behind or at the back of\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.064\"\r\n                                        },\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"put a piece of music on the less important side of (a vinyl recording)\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.065\"\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    \"language\": \"en\",\r\n                    \"lexicalCategory\": \"Verb\",\r\n                    \"text\": \"back\"\r\n                },\r\n                {\r\n                    \"entries\": [\r\n                        {\r\n                            \"homographNumber\": \"003\",\r\n                            \"senses\": [\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"of or at the back of something\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.068\",\r\n                                    \"subsenses\": [\r\n                                        {\r\n                                            \"definitions\": [\r\n                                                \"in a remote or subsidiary position\"\r\n                                            ],\r\n                                            \"id\": \"m_en_gbus0064260.070\"\r\n                                        }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"from or relating to the past\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.072\"\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"directed towards the rear or in a reversed course\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.074\"\r\n                                },\r\n                                {\r\n                                    \"definitions\": [\r\n                                        \"(of a sound) articulated at the back of the mouth\"\r\n                                    ],\r\n                                    \"id\": \"m_en_gbus0064260.076\"\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    \"language\": \"en\",\r\n                    \"lexicalCategory\": \"Adjective\",\r\n                    \"text\": \"back\"\r\n                }\r\n            ],\r\n            \"type\": \"headword\",\r\n            \"word\": \"back\"\r\n        }\r\n    ]\r\n}";
        }

        public ActionResult Logoff()
        {
            Session.Abandon();

            return RedirectToAction("Logon",new { infoMsg = "You are now signed out."});
        }
    }
}